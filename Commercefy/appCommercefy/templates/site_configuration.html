{% extends "base.html" %}
{% load static %}

{% block title %}Configuración del Sitio{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/dashboardtrabajador.css' %}">
  <style>
    .config-wrapper {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.05);
        max-width: 1000px;
        margin: 0 auto;
        overflow: hidden;
    }

    .nav-tabs {
        background: #f8f9fa;
        border-bottom: 2px solid #e5e7eb;
        border-radius: 12px 12px 0 0;
    }

    .nav-tabs .nav-link {
        color: #6b7280;
        border: none;
        border-bottom: 3px solid transparent;
        font-weight: 500;
        padding: 1rem 1.5rem;
        transition: all 0.3s ease;
    }

    .nav-tabs .nav-link:hover {
        color: #3b84f8;
        background: rgba(59, 132, 248, 0.05);
    }

    .nav-tabs .nav-link.active {
        color: #3b84f8;
        background: transparent;
        border-bottom-color: #3b84f8;
    }

    .tab-pane {
        padding: 2rem;
        display: none;
    }

    .tab-pane.show.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    .form-label {
        font-weight: 500;
        color: #4b5563;
        margin-bottom: 0.5rem;
    }

    .form-text {
        color: #9ca3af;
        font-size: 0.875rem;
    }

    .tab-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #e5e7eb;
    }

    .tab-header h5 {
        margin: 0;
        color: #1f2937;
        font-weight: 600;
    }

    .btn-reset-tab {
        background: #f3f4f6;
        color: #6b7280;
        border: 1px solid #d1d5db;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-size: 0.875rem;
        transition: all 0.3s ease;
    }

    .btn-reset-tab:hover {
        background: #e5e7eb;
        color: #374151;
        text-decoration: none;
    }

    .current-logo {
        max-width: 200px;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        padding: 0.5rem;
        margin-bottom: 1rem;
    }

    .color-input-group {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .color-input-group input[type="color"] {
        width: 60px;
        height: 40px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        cursor: pointer;
    }

    .form-control:focus {
        border-color: #3b84f8;
        box-shadow: 0 0 0 3px rgba(59, 132, 248, 0.1);
    }

    .btn-primary {
        background: #3b84f8;
        border-color: #3b84f8;
        padding: 0.625rem 1.5rem;
        border-radius: 6px;
    }

    .btn-primary:hover {
        background: #2c5cc0;
        border-color: #2c5cc0;
    }

    .btn-light {
        background: #f3f4f6;
        border: 1px solid #d1d5db;
        color: #374151;
    }

    .btn-light:hover {
        background: #e5e7eb;
        color: #1f2937;
    }

    .footer-actions {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        padding: 1.5rem 2rem;
        border-top: 1px solid #e5e7eb;
        background: #fafafa;
        border-radius: 0 0 12px 12px;
    }

    .text-danger {
        color: #dc2626;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }

    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .form-row.wide {
        grid-template-columns: 1fr;
    }
  </style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 fw-bold">Configuración del Sitio</h1>
        <a href="{% url 'dashboardadmin' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-2"></i>Volver al Dashboard
        </a>
    </div>

    <div class="config-wrapper">
        <form method="post" enctype="multipart/form-data" id="config-form">
            {% csrf_token %}
            
            <!-- Navigation Tabs -->
            <ul class="nav nav-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="brand-tab" data-bs-toggle="tab" data-bs-target="#brand-pane" type="button" role="tab">
                        <i class="bi bi-palette me-2"></i>Marca
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact-pane" type="button" role="tab">
                        <i class="bi bi-telephone me-2"></i>Contacto
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="appearance-tab" data-bs-toggle="tab" data-bs-target="#appearance-pane" type="button" role="tab">
                        <i class="bi bi-paint-bucket me-2"></i>Apariencia
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="announcement-tab" data-bs-toggle="tab" data-bs-target="#announcement-pane" type="button" role="tab">
                        <i class="bi bi-megaphone me-2"></i>Anuncios
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="social-tab" data-bs-toggle="tab" data-bs-target="#social-pane" type="button" role="tab">
                        <i class="bi bi-share me-2"></i>Redes Sociales
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="seo-tab" data-bs-toggle="tab" data-bs-target="#seo-pane" type="button" role="tab">
                        <i class="bi bi-search me-2"></i>SEO
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- BRAND TAB -->
                <div class="tab-pane fade show active" id="brand-pane" role="tabpanel">
                    <div class="tab-header">
                        <h5>Identidad de Marca</h5>
                        <form method="post" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="reset_tab" value="brand">
                            <button type="submit" class="btn-reset-tab">
                                <i class="bi bi-arrow-clockwise me-1"></i>Restablecer Tab
                            </button>
                        </form>
                    </div>

                    <div class="form-row wide">
                        <div>
                            <label for="{{ form.site_name.id_for_label }}" class="form-label">Nombre del Sitio</label>
                            {{ form.site_name }}
                            {% if form.site_name.errors %}
                                <div class="text-danger">{{ form.site_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="form-row wide mt-3">
                        <div>
                            <label for="{{ form.logo.id_for_label }}" class="form-label">Logo</label>
                            {% if form.instance.logo %}
                                <div class="d-block mb-2">
                                    <img src="{{ form.instance.logo.url }}" alt="Logo actual" class="current-logo">
                                    <div class="small text-muted">Logo actual</div>
                                </div>
                            {% endif %}
                            {{ form.logo }}
                            <div class="form-text">Se recomienda una imagen PNG con fondo transparente.</div>
                            {% if form.logo.errors %}
                                <div class="text-danger">{{ form.logo.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- CONTACT TAB -->
                <div class="tab-pane fade" id="contact-pane" role="tabpanel">
                    <div class="tab-header">
                        <h5>Información de Contacto</h5>
                        <form method="post" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="reset_tab" value="contact">
                            <button type="submit" class="btn-reset-tab">
                                <i class="bi bi-arrow-clockwise me-1"></i>Restablecer Tab
                            </button>
                        </form>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="{{ form.support_email.id_for_label }}" class="form-label">Email de Soporte</label>
                            {{ form.support_email }}
                            {% if form.support_email.errors %}
                                <div class="text-danger">{{ form.support_email.errors }}</div>
                            {% endif %}
                        </div>
                        <div>
                            <label for="{{ form.support_phone.id_for_label }}" class="form-label">Teléfono de Soporte</label>
                            {{ form.support_phone }}
                            {% if form.support_phone.errors %}
                                <div class="text-danger">{{ form.support_phone.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- APPEARANCE TAB -->
                <div class="tab-pane fade" id="appearance-pane" role="tabpanel">
                    <div class="tab-header">
                        <h5>Personalización de Colores</h5>
                        <form method="post" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="reset_tab" value="appearance">
                            <button type="submit" class="btn-reset-tab">
                                <i class="bi bi-arrow-clockwise me-1"></i>Restablecer Tab
                            </button>
                        </form>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="{{ form.primary_color.id_for_label }}" class="form-label">Color Primario</label>
                            <div class="color-input-group">
                                {{ form.primary_color }}
                                <span class="small text-muted">Botones y encabezados</span>
                            </div>
                        </div>
                        <div>
                            <label for="{{ form.secondary_color.id_for_label }}" class="form-label">Color Secundario</label>
                            <div class="color-input-group">
                                {{ form.secondary_color }}
                                <span class="small text-muted">Acentos y detalles</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-row mt-3">
                        <div>
                            <label for="{{ form.accent_color.id_for_label }}" class="form-label">Color de Acentos</label>
                            <div class="color-input-group">
                                {{ form.accent_color }}
                                <span class="small text-muted">Énfasis visual</span>
                            </div>
                        </div>
                        <div>
                            <label for="{{ form.button_hover_color.id_for_label }}" class="form-label">Color Hover Botones</label>
                            <div class="color-input-group">
                                {{ form.button_hover_color }}
                                <span class="small text-muted">Al pasar mouse</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-row mt-3">
                        <div>
                            <label for="{{ form.text_color.id_for_label }}" class="form-label">Color de Texto</label>
                            <div class="color-input-group">
                                {{ form.text_color }}
                                <span class="small text-muted">Texto general</span>
                            </div>
                        </div>
                        <div>
                            <label for="{{ form.background_color.id_for_label }}" class="form-label">Color de Fondo</label>
                            <div class="color-input-group">
                                {{ form.background_color }}
                                <span class="small text-muted">Fondo principal</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ANNOUNCEMENT TAB -->
                <div class="tab-pane fade" id="announcement-pane" role="tabpanel">
                    <div class="tab-header">
                        <h5>Configuración de Anuncios</h5>
                        <form method="post" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="reset_tab" value="announcement">
                            <button type="submit" class="btn-reset-tab">
                                <i class="bi bi-arrow-clockwise me-1"></i>Restablecer Tab
                            </button>
                        </form>
                    </div>

                    <div class="form-row wide">
                        <div class="form-check form-switch">
                            {{ form.show_announcement }}
                            <label class="form-check-label" for="{{ form.show_announcement.id_for_label }}">
                                Mostrar barra de anuncios en el sitio
                            </label>
                        </div>
                    </div>

                    <div class="form-row wide mt-3">
                        <div>
                            <label for="{{ form.announcement_text.id_for_label }}" class="form-label">Texto del Anuncio</label>
                            {{ form.announcement_text }}
                            <div class="form-text">Este texto se mostrará en la barra de anuncios si está habilitada.</div>
                            {% if form.announcement_text.errors %}
                                <div class="text-danger">{{ form.announcement_text.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- SOCIAL MEDIA TAB -->
                <div class="tab-pane fade" id="social-pane" role="tabpanel">
                    <div class="tab-header">
                        <h5>Enlaces a Redes Sociales</h5>
                        <form method="post" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="reset_tab" value="social">
                            <button type="submit" class="btn-reset-tab">
                                <i class="bi bi-arrow-clockwise me-1"></i>Restablecer Tab
                            </button>
                        </form>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="{{ form.facebook_url.id_for_label }}" class="form-label">
                                <i class="bi bi-facebook me-1"></i>Facebook
                            </label>
                            {{ form.facebook_url }}
                            {% if form.facebook_url.errors %}
                                <div class="text-danger">{{ form.facebook_url.errors }}</div>
                            {% endif %}
                        </div>
                        <div>
                            <label for="{{ form.instagram_url.id_for_label }}" class="form-label">
                                <i class="bi bi-instagram me-1"></i>Instagram
                            </label>
                            {{ form.instagram_url }}
                            {% if form.instagram_url.errors %}
                                <div class="text-danger">{{ form.instagram_url.errors }}</div>
                            {% endif %}
                        </div>
                        <div>
                            <label for="{{ form.twitter_url.id_for_label }}" class="form-label">
                                <i class="bi bi-twitter-x me-1"></i>Twitter/X
                            </label>
                            {{ form.twitter_url }}
                            {% if form.twitter_url.errors %}
                                <div class="text-danger">{{ form.twitter_url.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- SEO TAB -->
                <div class="tab-pane fade" id="seo-pane" role="tabpanel">
                    <div class="tab-header">
                        <h5>Optimización para Buscadores (SEO)</h5>
                        <form method="post" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="reset_tab" value="seo">
                            <button type="submit" class="btn-reset-tab">
                                <i class="bi bi-arrow-clockwise me-1"></i>Restablecer Tab
                            </button>
                        </form>
                    </div>

                    <div class="form-row wide">
                        <div>
                            <label for="{{ form.meta_description.id_for_label }}" class="form-label">Descripción del Sitio</label>
                            {{ form.meta_description }}
                            <div class="form-text">Esta descripción aparecerá en los resultados de búsqueda de Google. Se recomienda entre 120-160 caracteres.</div>
                            {% if form.meta_description.errors %}
                                <div class="text-danger">{{ form.meta_description.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Actions -->
            <div class="footer-actions">
                <a href="{% url 'dashboardadmin' %}" class="btn btn-light">
                    <i class="bi bi-x-lg me-2"></i>Cancelar
                </a>
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save me-2"></i>Guardar Cambios
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Mejora de UX: restablece el tab activo después de un reset
    document.querySelectorAll('form').forEach(form => {
        if (form.querySelector('input[name="reset_tab"]')) {
            form.addEventListener('submit', function(e) {
                const tabValue = this.querySelector('input[name="reset_tab"]').value;
                // Esperar a que se recargue la página
                setTimeout(() => {
                    const tabButton = document.getElementById(tabValue + '-tab');
                    if (tabButton) {
                        const tab = new bootstrap.Tab(tabButton);
                        tab.show();
                    }
                }, 100);
            });
        }
    });
</script>
{% endblock %}
